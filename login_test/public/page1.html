<!DOCTYPE html>
<head>
	<title>Page1</title>
	
	<script src="https://www.gstatic.com/firebasejs/5.8.4/firebase.js"></script>
	<script>
  // Initialize Firebase
  var config = {
  	apiKey: "AIzaSyAPAts9WwBlTlkKangEXRzpIZMHDdcLXFw",
  	authDomain: "group-12-4ca6d.firebaseapp.com",
  	databaseURL: "https://group-12-4ca6d.firebaseio.com",
  	projectId: "group-12-4ca6d",
  	storageBucket: "group-12-4ca6d.appspot.com",
  	messagingSenderId: "215325431071"
  };
  firebase.initializeApp(config);
</script>

<link rel="stylesheet" type="text/css" href="theme.css">
</head>
<body>
	<p>TestTestTestTestTestTestTestTestTestTestTestTestTestTestTestTestTestTestTestTestTestTestTestTestTest</p>
	<button id= "sign_out"> Sign out</button>
	<button id= "verify_email"> Send Email Verfication </button>
	<button id= "who_am_i"> Who am I? </button>
	<button id= "add">ADD TO DATABASE </button>
  <button id= "toRestuarants">To Restuarant creator</button>

	<img id= "f22" src= "f22.jpg" alt="an f22">
</body>

<script type= "text/javascript">
	var flag = true, db = firebase.firestore();

	//send verification email
	function sendEmailVerification() {
      // [START sendemailverification]
      firebase.auth().currentUser.sendEmailVerification().then(function() {
        // Email Verification sent!
        // [START_EXCLUDE]
        alert('Email Verification Sent!');
        // [END_EXCLUDE]
    });
      // [END sendemailverification]
  }

  function signOut(){

  	if (firebase.auth().currentUser) {
        // [START signout]
        firebase.auth().signOut();
        // [END signout]
        // Go to index
        window.location='login.html';

    }

}

function whoAmI(){
	var user = firebase.auth().currentUser;
	var name, email, photoUrl, uid, emailVerified;

	if (user != null) {
		name = user.displayName;
		email = user.email;
		photoUrl = user.photoURL;
		emailVerified = user.emailVerified;
		uid = user.uid
	}
	window.alert("email: "+ email + "\n uid: "+ uid +"\n is email verified: "+ emailVerified);
}
function logUser() {
	console.log("hello");
    var user = firebase.auth().currentUser;

	console.log(user.uid);
        db.collection("users").where("id", "==", firebase.auth().currentUser.uid).get().then(function(snapshot) {
          snapshot.forEach(function(doc) {
            console.log(flag);
            flag = false;
          });
        });
        console.log(flag);
        if(flag){
          if (user != null) {
           db.collection("users").add({
            email:user.email,
            id:user.uid,
            userType:"owner"
           }).then(function(docRef) {
            console.log("doc written");
           }).catch(function(error) {
            console.error(error);
           });
         }
        }


}

document.getElementById('sign_out').addEventListener('click',signOut, false);
document.getElementById('verify_email').addEventListener('click', sendEmailVerification, false);
document.getElementById('who_am_i').addEventListener('click',whoAmI,false);
document.getElementById('add').addEventListener('click',logUser,false);
document.getElementById('toRestuarants').addEventListener('click',window.location=dummyRestuarantCreator.html,false);

</script>