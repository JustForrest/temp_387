<html>
<head>
	<title>Restuarant Management</title>
	<script src="https://www.gstatic.com/firebasejs/5.8.4/firebase.js"></script>
	<script>
		var restuarantDoc, restuarantId, resLocation, name, resStyle, resSchedule, thisUser, uid, snap, docID;
		var config = {
			apiKey: "AIzaSyAPAts9WwBlTlkKangEXRzpIZMHDdcLXFw",
  			authDomain: "group-12-4ca6d.firebaseapp.com",
  			databaseURL: "https://group-12-4ca6d.firebaseio.com",
  			projectId: "group-12-4ca6d",
  			storageBucket: "group-12-4ca6d.appspot.com",
  			messagingSenderId: "215325431071"
		};
		firebase.initializeApp(config);
		user = firebase.auth().currentUser;
		function loadUser() {
			firebase.auth().onAuthStateChanged(function(user) {
				if (user) {
					thisUser = user;
					uid = user.uid;
					console.log(uid);
					readDatabase();
				} else {
					console.log("na");
					loadUser();
				}
			});
		}
		function setUID() {
			setTimeout(uid = firebase.auth().currentUser.uid,500)
		}
		function query(collection, field, condition, contents) {
			var db = firebase.firestore();
			db.collection(collection).where(field, condition, contents).get().then(function(snapshot) {
				return snapshot;
			})
		}
		function readDatabase() {
			console.log("test2");
			var db = firebase.firestore();
			snap = query("users", "id", "==", uid);
			console.log(snap);
			var db = firebase.firestore();
			db.collection("users").where("id", "==", uid).get().then(function(snapshot) {
				snapshot.forEach(function(doc) {
					console.log("test3");
					var data = doc.data();
					restuarantId = data.restuarantIDs[0];
					console.log(restuarantId);
				});

			});
			
			snap = query("restuarants", "style", "==", "mexican");
			db.collection("restuarants").where("style", "==", "mexican").get().then(function(snapshot) {
				snapshot.forEach(function(doc) {
					console.log("test4");
					console.log(doc.data());
					console.log(doc.id);
					console.log(doc);
					docID = doc.id;
					restuarantDoc = doc;
					console.log(restuarantDoc.id);
					var data = restuarantDoc.data();
					resSchedule = data.schedule;
					name = data.restuarantName;
					resStyle = data.style;
					resLocation = data.location;
					resetFields();
				});

			});
			
			console.log(name);
			console.log(resLocation);
			console.log(resSchedule);
		}
		function resetFields() {
			console.log("test5");
			document.getElementById("resName").value = name;
			document.getElementById("street").value = resLocation.street;
			document.getElementById("city").value = resLocation.city;
			document.getElementById("state").value = resLocation.state;
			document.getElementById("zip").value = resLocation.zip;
			document.getElementById("type").value = resStyle;
			document.getElementById("monday").value = resSchedule.monday;
			document.getElementById("tuesday").value = resSchedule.tuesday;
			document.getElementById("wednesday").value = resSchedule.wednesday;
			document.getElementById("thursday").value = resSchedule.thursday;
			document.getElementById("friday").value = resSchedule.friday;
			document.getElementById("saturday").value = resSchedule.saturday;
			document.getElementById("sunday").value = resSchedule.sunday;
		}
		function writeDatabase() {
			var reference = firebase.database().ref("restuarants/" + docID);
			name = document.getElementById("resName").value;
			location = {
				street:document.getElementById("street").value,
				city:document.getElementById("city").value,
				state:document.getElementById("state").value,
				zip:document.getElementById("zip").value
			}
			style = document.getElementById("type").value;
			schedule = {
				monday:document.getElementById("monday").value,
				tuesday:document.getElementById("tuesday").value,
				wednesday:document.getElementById("wednesday").value,
				thursday:document.getElementById("thursday").value,
				friday:document.getElementById("friday").value,
				saturday:document.getElementById("saturday").value,
				sunday:document.getElementById("sunday").value
			}
			reference.update({
				restuarantName:name,
				location:resLocation,
				style:resStyle,
				schedule:resSchedule
			});
		}
		function toMenu() {
			window.location = 'menuEditor.html';
		}
		function toDashboard() {
			window.location = 'restuarantOwner.html';
		}
		function toOrder() {
			window.location = 'restuarantEditor.html';
		}
	</script>
</head>
<body>
	<p>Edit your restuarant's information</p>
	<br>
	<p>Restuarant Name:</p>
	<input type="text" id="resName" name="resName"/>
	<p>Address:</p>
	<input type="text" id="street" name="street"/>
	<input type="text" id="city" name="city"/>
	<input type="text" id="state" name="state"/>
	<input type="text" id="zip" name="zip"/>
	<p>Cuisine type:</p>
	<input type="text" id="type" name="type"/>
	<p>Hours:</p>
	<input type="text" id="monday" name="monday"/>
	<input type="text" id="tuesday" name="tuesday"/>
	<input type="text" id="wednesday" name="wednesday"/>
	<input type="text" id="thursday" name="thursday"/>
	<input type="text" id="friday" name="friday"/>
	<input type="text" id="saturday" name="saturday"/>
	<input type="text" id="sunday" name="sunday"/>
	<button id="menu">Menu Editing</button>
	<button id="save">Save Changes</button>
	<button id="order">Order Management</button>
	<button id="dashboard">Back to dashboard</button>
</body>
<script>
	document.getElementById('save').addEventListener('click',writeDatabase,false);
	document.getElementById('menu').addEventListener('click',toMenu,false);
	document.getElementById('order').addEventListener('click',toOrder,false);
	document.getElementById('dashboard').addEventListener('click',toDashboard,false);
	console.log("test1");
	loadUser();
</script>
</html>
